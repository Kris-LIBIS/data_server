- ingest_agreement: 'KerkEnLeven'
  name: 'KerkEnLeven'
  description: 'Ingest workflow for Kerk en Leven'
  stages:
    - stage: 'Collect'
      workflow: 'Recursive file collect'
    - stage: 'PreProcess'
      workflow: 'checksum + format + mimetype'
      values:
        mimetype_regexp: 'image/jpeg|application/pdf'
    - stage: 'PreIngest'
      workflow: 'group + alma + collection'
      values:
        group_regex: '^([^_]+)_([^_]+)_([^_]+)_(.+)\.(.+)$'
        collection_label: '$1 + " " + $1 + "/" + $2'
        group_name: '"#{$1}_#{$2}_#{$3}"'
        group_label: '$1 + ", " + $2 + ", nr. " + $3+ " (" + $1 + ")"'
        file_label: '"pagina " + $4'
        collection_navigate: true
        collection_publish: true
        field: 'alma.local_field_983'
        term: 'item.name.scan(/^KYE[0-9]+/).first'
        match_regex: '^KYE'
        converter: 'Kuleuven'
        title_to_name: false
        title_to_label: false
        new_label: 'item.label.sub(item.name.scan(/^KYE[0-9]+/).first, title)'
        fail_on_not_found: true
    - stage: 'Ingest'
      workflow: 'METS ingest'
      values:
        force_label_to_title: true
    - stage: 'PostIngest'
      workflow: 'CSV export'
      values:
        export_dir: '/nas/vol04/export/kadocadmin/ingest'
  parameters:
    location:
      targets: ['Recursive file collect#location', 'checksum + format + mimetype#location']
      default: '/nas/vol04/upload/flandrica/kadoc/kadoc'
    selection:
      targets: ['Recursive file collect#selection']
      default: '^KYE[0-9]+_[^_]+_[^_]+_.+\.(JPG|jpg|PDF|pdf)$'
    checksum_file:
      targets: ['checksum + format + mimetype#checksum_file']
      default: '/nas/vol04/upload/flandrica/kadoc/kadoc'
    base_collection:
      targets: ['group + alma + collection#base_collection']
      default: 'E_periodieken/Parochiebladen'
